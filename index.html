<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Claude Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg: #0f0f0f; --surface: #1a1a1a; --surface2: #252525;
    --border: #333; --text: #e8e8e8; --text-dim: #888;
    --accent: #7c6bf5; --accent-hover: #6a58e0;
    --user-bg: #2a2545; --ai-bg: #1e1e1e;
  }
  body {
    font-family: 'Inter', sans-serif; background: var(--bg);
    color: var(--text); height: 100dvh; display: flex; flex-direction: column;
  }
  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 20px; border-bottom: 1px solid var(--border);
    background: var(--surface);
  }
  header h1 { font-size: 16px; font-weight: 600; }
  header span { font-size: 11px; color: var(--text-dim); background: var(--surface2);
    padding: 3px 8px; border-radius: 6px; }
  #chat-area {
    flex: 1; overflow-y: auto; padding: 20px; display: flex;
    flex-direction: column; gap: 16px;
  }
  .msg { max-width: 780px; width: 100%; margin: 0 auto; padding: 14px 18px;
    border-radius: 12px; line-height: 1.65; font-size: 14px; white-space: pre-wrap;
    word-wrap: break-word; }
  .msg.user { background: var(--user-bg); border: 1px solid #3a3260; align-self: flex-end; }
  .msg.assistant { background: var(--ai-bg); border: 1px solid var(--border); }
  .msg-label { font-size: 11px; font-weight: 600; color: var(--text-dim);
    margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
  .msg.user .msg-label { color: var(--accent); }
  #input-area {
    padding: 16px 20px; border-top: 1px solid var(--border);
    background: var(--surface); display: flex; gap: 10px; align-items: flex-end;
  }
  #input-area textarea {
    flex: 1; resize: none; background: var(--surface2); color: var(--text);
    border: 1px solid var(--border); border-radius: 10px; padding: 12px 14px;
    font-family: inherit; font-size: 14px; line-height: 1.5;
    max-height: 160px; overflow-y: auto; outline: none;
    transition: border-color 0.2s;
  }
  #input-area textarea:focus { border-color: var(--accent); }
  #input-area button {
    background: var(--accent); color: #fff; border: none; border-radius: 10px;
    padding: 12px 20px; font-size: 14px; font-weight: 600; cursor: pointer;
    transition: background 0.2s; white-space: nowrap;
  }
  #input-area button:hover { background: var(--accent-hover); }
  #input-area button:disabled { opacity: 0.4; cursor: not-allowed; }
  .typing { color: var(--text-dim); font-style: italic; }
  .error-text { color: #f87171; }
  #chat-area::-webkit-scrollbar { width: 6px; }
  #chat-area::-webkit-scrollbar-track { background: transparent; }
  #chat-area::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
  @media (max-width: 600px) {
    .msg { font-size: 13px; padding: 12px 14px; }
    #input-area { padding: 12px; }
  }
</style>
</head>
<body>
<header>
  <h1>ðŸ’¬ Claude Chat</h1>
  <span>via cc.580ai.net</span>
</header>

<div id="chat-area">
  <div class="msg assistant">
    <div class="msg-label">Claude</div>
    Hello! How can I help you today?
  </div>
</div>

<div id="input-area">
  <textarea id="user-input" rows="1" placeholder="Type your messageâ€¦"
    onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage();}"></textarea>
  <button id="send-btn" onclick="sendMessage()">Send</button>
</div>

<script>
const chatArea = document.getElementById('chat-area');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

let conversationHistory = [];

// Auto-resize textarea
userInput.addEventListener('input', () => {
  userInput.style.height = 'auto';
  userInput.style.height = Math.min(userInput.scrollHeight, 160) + 'px';
});

function addMessage(role, text, isError = false) {
  const div = document.createElement('div');
  div.className = `msg ${role}`;
  const label = document.createElement('div');
  label.className = 'msg-label';
  label.textContent = role === 'user' ? 'You' : 'Claude';
  div.appendChild(label);
  const content = document.createElement('span');
  content.textContent = text;
  if (isError) content.className = 'error-text';
  div.appendChild(content);
  chatArea.appendChild(div);
  chatArea.scrollTop = chatArea.scrollHeight;
  return div;
}

function addTyping() {
  const div = document.createElement('div');
  div.className = 'msg assistant';
  div.id = 'typing-indicator';
  const label = document.createElement('div');
  label.className = 'msg-label';
  label.textContent = 'Claude';
  div.appendChild(label);
  const span = document.createElement('span');
  span.className = 'typing';
  span.textContent = 'Thinkingâ€¦';
  div.appendChild(span);
  chatArea.appendChild(div);
  chatArea.scrollTop = chatArea.scrollHeight;
}

function removeTyping() {
  const el = document.getElementById('typing-indicator');
  if (el) el.remove();
}

async function sendMessage() {
  const text = userInput.value.trim();
  if (!text) return;

  addMessage('user', text);
  conversationHistory.push({ role: 'user', content: text });

  userInput.value = '';
  userInput.style.height = 'auto';
  sendBtn.disabled = true;
  addTyping();

  try {
    const res = await fetch('/.netlify/functions/claude-proxy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 8192,
        messages: conversationHistory
      })
    });

    removeTyping();

    if (!res.ok) {
      const errData = await res.json().catch(() => ({}));
      const errMsg = errData.error?.message || errData.error || `HTTP ${res.status}`;
      addMessage('assistant', `Error: ${errMsg}`, true);
      sendBtn.disabled = false;
      return;
    }

    const data = await res.json();
    const reply = data.content?.[0]?.text || '(empty response)';
    addMessage('assistant', reply);
    conversationHistory.push({ role: 'assistant', content: reply });
  } catch (err) {
    removeTyping();
    addMessage('assistant', `Error: ${err.message}`, true);
  }

  sendBtn.disabled = false;
  userInput.focus();
}
</script>
</body>
</html>
